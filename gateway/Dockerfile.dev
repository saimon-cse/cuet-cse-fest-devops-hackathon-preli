FROM node:20-slim 

WORKDIR /app

COPY package.json ./

RUN npm install --omit=dev --no-progress

COPY . .

EXPOSE 5921
HEALTHCHECK --interval=30s --timeout=5s --retries=3 CMD node -e "fetch('http://localhost:5921/health').then(res=>process.exit(res.ok?0:1)).catch(()=>process.exit(1))"
CMD ["npm", "run", "dev"]